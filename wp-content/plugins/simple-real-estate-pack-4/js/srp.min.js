function addLoadEvent(r){var e=window.onload;"function"!=typeof window.onload?window.onload=r:window.onload=function(){e&&e(),r()}}function _fixed_tb_remove(){return jQuery("#TB_imageOff").unbind("click"),jQuery("#TB_closeWindowButton").unbind("click"),jQuery("#TB_window").fadeOut("fast",function(){jQuery("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload","tb_unload").unbind().remove()}),jQuery("body").removeClass("modal-open"),jQuery("#TB_window,#TB_overlay,#TB_HideSelect").one("unload",killTheDamnUnloadEvent),jQuery("#TB_load").remove(),"undefined"==typeof document.body.style.maxHeight&&(jQuery("body","html").css({height:"auto",width:"auto"}),jQuery("html").css("overflow","")),jQuery(document).unbind(".thickbox"),!1}function killTheDamnUnloadEvent(r){return r.stopPropagation(),r.stopImmediatePropagation(),!1}function _icon_array(r,e){var a={position:"",title:r,map:srp_map,icon:new google.maps.MarkerImage(_get_icon(r),new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37))};return a}function _get_icon(r){var e={Schools:"schools.png","Grocery Stores":"grocery.png",Restaurants:"restaurants.png",Hospitals:"hospitals.png","Golf Cources":"golf.png",Banks:"banks.png","Gas Stations":"gas_stations.png"};return srp.srp_url+"/images/icons/"+e[r]}function srp_custom_icons(){var r=_icon_array("Schools","schools.png"),e=_icon_array("Grocery Stores","grocery.png"),a=_icon_array("Restaurants","restaurants.png"),n=_icon_array("Hospitals","hospitals.png"),o=_icon_array("Golf Cources","golf.png"),s=_icon_array("Banks","banks.png"),t=_icon_array("Gas Stations","gas_stations.png");custom_icons.schools=r,custom_icons.education=r,custom_icons.grocery=e,custom_icons.restaurants=a,custom_icons.hospitals=n,custom_icons.golf=o,custom_icons.banks=s,custom_icons.gas_stations=t}function srp_setDefaultMarker(r,e){var a=new google.maps.InfoWindow({content:e}),n=new google.maps.Marker({position:r,map:srp_map});n.setMap(srp_map),google.maps.event.addListener(n,"click",function(){a.open(srp_map,n,{maxWidth:315})})}function srp_createMarker(r,e,a){srp_custom_icons();var n=custom_icons[a];n.position=r;var o=new google.maps.Marker(n),s=new google.maps.InfoWindow({content:e});return google.maps.event.addListener(o,"click",function(){openedInfoWindow&&openedInfoWindow.close(),s.open(srp_map,o),openedInfoWindow=s}),o}function srp_createMarkerCustom(r,e,a,n,o,s){var t=new GMarker(r,custom_icons[n]),p=s+"<strong>"+e+"</a></strong> <br />"+a+'<br /><a href="'+o+'">listing info</a>',i=new google.maps.InfoWindow({content:p});return google.maps.event.addListener(t,"click",function(){i.open(srp_map,t)}),t}function srp_initialize(){var r={zoom:13,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP};srp_map=new google.maps.Map(document.getElementById("gre_map_canvas"),r),srp_setupmap()}function srp_setupmap(){var r=new google.maps.LatLng(srp_listing_values.lat,srp_listing_values.lng),e=new google.maps.Geocoder,a={lat:parseFloat(srp_listing_values.lat),lng:parseFloat(srp_listing_values.lng)};e.geocode({location:a},function(r,e){if("OK"===e){var a=null;r[0]?a=r[0].formatted_address:r[1]?a=r[1].formatted_address:r[2]&&(a=r[2].formatted_address),a&&(srp_map_location=a.replace(", USA","")),console.log(srp_map_location)}else window.alert("Geocoder failed due to: "+e)}),srp_map.setCenter(r,13),srp_setDefaultMarker(r,srp_listing_values.html)}function srp_addOverlay(r){"undefined"!=typeof gre_map?r.setMap(gre_map):"undefined"!=typeof srp_map&&r.setMap(srp_map)}function srp_removeOverlay(r){"undefined"!=typeof gre_map?r.setMap(null):"undefined"!=typeof srp_map&&r.setMap(null)}function srp_function_exists(r,e,a,n){return jQuery.post(srp.ajaxurl,{action:"srp_function_exists",name:r,type:e},function(r){"1"===r&&("undefined"!=typeof n?a(n):a())}),!1}function srp_requestYelp(r){var e=jQuery("#srp_gre_prop_coord").val(),a=e.split(","),n=jQuery(r).attr("name");if(jQuery(r).attr("checked")){if(markerArray.length>0){for(var o=!1,s=0;s<markerArray.length;s++)markerArray[s].cat==n&&(o=!0,srp_addOverlay(markerArray[s]),jQuery(".srp_gre_legend span."+n).remove());if(1==o){var t='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";return jQuery("#map div.srp_gre_legend").append(t),!1}}var p=srp_ajax_loaderStart("gre_map_canvas",null);return jQuery.post(srp.ajaxurl,{action:"srp_getYelp_ajax",term:n,lat:a[0],lng:a[1],location:srp_map_location},function(r){srp_mapYelp(r),srp_ajax_loaderStop(p)},"json"),!1}for(var s=0;s<markerArray.length;s++)markerArray[s].cat==n&&(srp_removeOverlay(markerArray[s]),jQuery(".srp_gre_legend span."+n).remove());return!1}function srp_mapYelp(r){if(r.message){var e=srp_ajax_loaderStart("gre_map_canvas",r.message);return setTimeout(function(){srp_ajax_loaderStop(e)},2e3),!1}if("undefined"!=typeof r&&0!=r&&r!=-1){var a=r;for(var n in a){for(var o in a[n]){var s=a[n][o].lat,t=a[n][o].lng,p=a[n][o].html,i=new google.maps.LatLng(s,t),l=srp_createMarker(i,p,n);l.cat=n,markerArray.push(l),srp_addOverlay(l)}var _='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";jQuery("#map div.srp_gre_legend").append(_)}}}function srp_requestSchools(){var r=jQuery("#srp_gre_prop_coord").val(),e=r.split(","),a=null,n="schools";if(jQuery("input#schools_select").attr("checked")){if(markerArray.length>0){for(var o=!1,s=0;s<markerArray.length;s++)markerArray[s].cat==n&&(o=!0,srp_addOverlay(markerArray[s]),jQuery(".srp_gre_legend span."+n).remove());if(1==o){var t='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";return jQuery("#map div.srp_gre_legend").append(t),!1}}var p=srp_ajax_loaderStart("gre_map_canvas",null);return jQuery.post(srp.ajaxurl,{action:"srp_getSchools_ajax",address:a,lat:e[0],lng:e[1]},function(r){srp_mapSchools(r),srp_ajax_loaderStop(p)},"json"),!1}for(var s=0;s<markerArray.length;s++)markerArray[s].cat==n&&(srp_removeOverlay(markerArray[s]),jQuery(".srp_gre_legend span."+n).remove());return!1}function srp_mapSchools(r){if(r.message){var e=srp_ajax_loaderStart("gre_map_canvas",r.message);return setTimeout(function(){srp_ajax_loaderStop(e)},2e3),!1}var a=(jQuery("#srp_education").attr("id"),r.markers);for(var n in a){var o=a[n].lat,s=a[n].lng,t=a[n].html,p=new google.maps.LatLng(o,s),i=srp_createMarker(p,t,"schools");i.cat="schools",markerArray.push(i),i.setMap(srp_map)}var l='<span class="schools"><img src="'+_get_icon(custom_icons[i.cat].title)+'" /> - '+custom_icons[i.cat].title+"</span>";return jQuery("#map div.srp_gre_legend").append(l),!1}function srp_ajax_loaderStart(r,e){loadingOnMap+=1;var a="srp_ajax_loading";if(jQuery("#"+a).length)return a;var n,o,s;null!=r&&"undefined"!=r?(o=jQuery("#"+r).width(),s=jQuery("#"+r).height(),n="#"+r):(n="body",o=jQuery(window).width(),s=jQuery(window).height());var t='<img src="'+srp.srp_url+'/images/ajax-loader.gif" alt="Loading. Please wait.">';null!=e&&"undefined"!=e||(e="Loading...");var p='<div id="'+a+'" class="ajax_loader">'+t+e+"</div>";jQuery(n).prepend(p);var i=jQuery("#"+a).width(),l=jQuery("#"+a).height(),_=o/2-i/2,u=s/2-l/2;return jQuery("#"+a).css({top:u,left:_}),a}function srp_ajax_loaderStop(r){loadingOnMap-=1,loadingOnMap<1&&(jQuery("#srp_ajax_loading").remove(),loadingOnMap=0)}function srp_profile(r){if(10==r)return!1;if(!r)var r=0;for(var e=load_srp_functions.length,a=srp_ajax_loaderStart("srp_extension",null),n=0;n<e;n++){var o=JSON.stringify(srp_listing_values),s=load_srp_functions[n];return jQuery.ajax({type:"POST",url:srp.ajaxurl,data:{action:"srp_ajax_call",callback:s,srp_listing_values:o},success:function(e){srp_output_gre(e),srp_ajax_loaderStop(a),r++,load_srp_functions.splice("",1),load_srp_functions.length>0&&srp_profile(r)},async:!0,dataType:"text"}),!1}return!1}function srp_profile_tabs(r){if(10==r)return!1;if(!r)var r=0;for(var e=load_srp_functions.length,a=srp_ajax_loaderStart("srp_extension",null),n=0;n<e;n++){var o=JSON.stringify(srp_listing_values),s=load_srp_functions[n];jQuery.ajax({type:"POST",url:srp.ajaxurl,data:{action:"srp_ajax_call",callback:s,srp_listing_values:o},success:function(r){srp_output_gre(r),srp_ajax_loaderStop(a)},async:!0,dataType:"text"})}return!1}function srp_output_gre(r){jQuery("#srp_extension").append(r),srp_check_prefilled(),jQuery("#srp-tab-wrap").data("ui-tabs")&&jQuery("#srp-tab-wrap").tabs("destroy"),srp_refresh_tabs("#srp-tab-wrap"),srp_refresh_tabs(".srp-tabs")}function srp_refresh_tabs(r){jQuery(r).length&&jQuery.fn.tabs&&jQuery(r).tabs()}var srp_map,custom_icons=[],loadingOnMap=0,markerArray;markerArray=new Array,jQuery(window).load(function(){if(window.tb_remove=function(){_fixed_tb_remove()},srp_refresh_tabs("#srp-tab-wrap"),srp_refresh_tabs(".srp-tabs"),jQuery.browser.msie&&jQuery('input[id^="yelp_cat_"]').click(function(){this.blur(),this.focus()}),jQuery('input[id^="yelp_cat_"]').change(function(){srp_requestYelp(this)}),"undefined"!=typeof srp_listing_values){var r,e=0;r=setInterval(function(){if(window.google&&window.google.maps)clearInterval(r),srp_initialize();else if(500==e){var a=srp.srp_gmap_key?srp.srp_gmap_key:"";jQuery.getScript("http://maps.googleapis.com/maps/api/js?key="+a)}else e>=5e3&&(console.error("SREP Maps API timed out."),clearInterval(r));e+=100},100)}"undefined"!=typeof srp_profile_view&&window[srp_profile_view]()});var openedInfoWindow=null,srp_map_location=null;